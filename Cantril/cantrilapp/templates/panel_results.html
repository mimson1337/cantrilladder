{% extends 'base.html' %}
{% block title %}Wyniki ankiet{% endblock %}

{% block content %}
  <h2 class="center">Wyniki ankiet</h2>
  <form method="get" style="max-width:920px; margin:0.5rem auto; display:flex; gap:8px; align-items:center;">
    <button type="button" class="btn" onclick="location.href='{% url 'panel_home' %}'">← Panel</button>
    {% if survey_id %}
      <button type="button" class="btn" onclick="location.href='{% url 'panel_history' %}?q={{ survey_id }}'">← Wróć do historii</button>
    {% endif %}
    <input name="pesel" value="{{ pesel }}" placeholder="PESEL" style="flex:1; padding:8px;" />
    <button class="btn" type="submit">Filtruj</button>
  </form>

  <div class="wide" style="max-width:1200px; margin:1rem auto;">
    <table class="app-table" style="width:100%;">
      <thead>
          <tr style="text-align:left; border-bottom:1px solid #e5e7eb;">
          <th>PESEL</th>
          <th>Ankieta</th>
          <th>Pytanie</th>
          <th>Typ</th>
          <th>Wartość / Tekst</th>
          <th>Ocena</th>
          <th>Audio</th>
          <th>Kiedy</th>
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
          <tr style="border-bottom:1px solid #f3f4f6;">
            <td>{{ r.patient_pesel }}</td>
            <td>{{ r.survey_label }}</td>
            <td style="max-width:320px;">{{ r.question_text }}</td>
            <td>{{ r.response_type_label }}</td>
            <td style="max-width:260px;">{% if r.response_type == 'scale' %}{{ r.scale_value }}{% else %}{{ r.text_answer }}{% endif %}</td>
            <td>{{ r.evaluated_label }}</td>
            <td>{% if r.audio_file %}<a href="{{ r.audio_file }}">Plik</a>{% endif %}</td>
            <td title="{{ r.created_cet }}">{{ r.created_label }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="8" style="text-align:center; padding:10px;">Brak danych</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}
